<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RoScript Browser</title>
  <style>
    /* your full UI CSS here (cards, topbar, modal, etc.) */
    /* --- KEEPING THE SAME STYLES YOU SHARED EARLIER --- */
  </style>
</head>
<body>

  <!-- Top bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">R</div>
        <span>RoScript</span>
      </div>
      <div class="search">
        <span class="icon i">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="7" stroke-width="2"/>
            <path d="M20 20l-3-3" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        <input id="search" placeholder="Search for Roblox scripts..." />
      </div>
    </div>
  </div>

  <!-- Hero -->
  <div class="hero">
    <h1>RoScript Browser</h1>
    <p>Discover and download the best Roblox scripts from ScriptBlox.</p>
  </div>

  <!-- Grid -->
  <div class="wrap">
    <div id="grid" class="grid"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="sheet-head">
        <div>
          <div class="sheet-title" id="mTitle">Title</div>
          <div class="sheet-game" id="mGame">Game name</div>
        </div>
        <span id="mPatched" class="patched" style="display:none">Patched</span>
        <button id="close" class="sheet-close">✕</button>
      </div>
      <div class="sheet-body">
        <div id="mDesc" class="sheet-desc"></div>
        <pre id="mCode" class="code">Loading script…</pre>
        <div class="actions">
          <button id="copy" class="btn primary">Copy Script</button>
          <a id="openPage" class="btn" href="#" target="_blank">Open on ScriptBlox</a>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">Copied!</div>

<script>
  // helpers
  const $ = sel => document.querySelector(sel);
  const grid = $('#grid');
  const searchInput = $('#search');
  const modal = $('#modal');
  const mTitle = $('#mTitle');
  const mGame = $('#mGame');
  const mPatched = $('#mPatched');
  const mDesc = $('#mDesc');
  const mCode = $('#mCode');
  const copyBtn = $('#copy');
  const openPage = $('#openPage');
  const closeBtn = $('#close');
  const toast = $('#toast');

  let ALL = [];

  function clamp(str, n){ return str && str.length > n ? str.slice(0,n-1)+'…' : str; }
  function nfmt(n){ if(n>=1e6)return(n/1e6).toFixed(1)+'M'; if(n>=1e3)return(n/1e3).toFixed(1)+'K'; return n||0; }
  function fmtDate(iso){ return new Date(iso).toLocaleDateString(); }

  // Fetch homepage scripts
  async function fetchScripts(){
    const res = await fetch('https://scriptblox.com/api/script/fetch');
    const data = await res.json();
    ALL = data?.result?.scripts || [];
    render(ALL);
  }

  // Search scripts
  async function searchScripts(query){
    const res = await fetch(`https://scriptblox.com/api/script/search?q=${encodeURIComponent(query)}`);
    const data = await res.json();
    const list = data?.result?.scripts || [];
    render(list);
  }

  // Render cards
  function render(list){
    grid.innerHTML = '';
    list.forEach(s=>{
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `
        ${s.isPatched ? `<span class="patched">Patched</span>`:''}
        <div class="title">${clamp(s.title,56)}</div>
        <div class="subtitle">${s?.game?.name || 'Universal'}</div>
        <div class="desc">${clamp(s.description || 'No description',180)}</div>
        <div class="stats">
          <span>${nfmt(s.views)} views</span>
          <span>${fmtDate(s.createdAt)}</span>
        </div>
      `;
      el.onclick = ()=>openSheet(s);
      grid.appendChild(el);
    });
  }

  // Get full script code
  async function getScriptCode(s){
    if(s.script) return s.script;
    if(s.slug){
      const r = await fetch(`https://scriptblox.com/api/script/details?slug=${s.slug}`);
      const d = await r.json();
      return d?.script?.script || d?.script?.content || null;
    }
    return null;
  }

  // Open modal
  async function openSheet(s){
    mTitle.textContent = s.title;
    mGame.textContent = s?.game?.name || 'Universal';
    mPatched.style.display = s.isPatched?'inline-block':'none';
    mDesc.textContent = s.description || '';
    mCode.textContent = 'Loading script…';
    openPage.href = `https://scriptblox.com/script/${s.slug}`;

    modal.style.display='grid';
    document.body.style.overflow='hidden';

    const code = await getScriptCode(s);
    mCode.textContent = code || 'No script available';
    copyBtn.onclick = ()=>navigator.clipboard.writeText(code||'').then(()=>showToast('Copied!'));
  }

  function closeSheet(){ modal.style.display='none'; document.body.style.overflow=''; }
  closeBtn.onclick = closeSheet;
  modal.onclick = e=>{ if(e.target===modal) closeSheet(); };

  // Search handler
  searchInput.oninput = e=>{
    const q = e.target.value.trim();
    if(!q) render(ALL);
    else searchScripts(q);
  };

  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = 'block';
    clearTimeout(showToast.t);
    showToast.t=setTimeout(()=>toast.style.display='none',1400);
  }

  // Init
  fetchScripts();
</script>
</body>
</html>
