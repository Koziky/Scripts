<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RoScript Browser</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --border: #334155;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --accent: #3b82f6;
      --danger: #ef4444;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      margin: 0;
    }
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 28px;
      background: #111827;
      border-bottom: 1px solid var(--border);
    }
    header img {
      width: 36px;
      height: 36px;
      border-radius: 8px;
    }
    header input {
      flex: 1;
      background: #1e293b;
      border: 1px solid var(--border);
      padding: 10px 14px;
      border-radius: 10px;
      color: var(--text);
      font-size: 15px;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin: 28px 0 6px;
    }
    p.sub {
      text-align: center;
      color: var(--muted);
      margin-bottom: 30px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 22px;
      padding: 0 28px 50px;
      max-width: 1300px;
      margin: 0 auto;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: transform .15s, box-shadow .15s;
      cursor: pointer;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.4);
    }
    .title {
      font-size: 17px;
      font-weight: 600;
    }
    .game {
      color: var(--muted);
      font-size: 14px;
    }
    .desc {
      font-size: 14px;
      line-height: 1.4;
      color: #cbd5e1;
    }
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .tag {
      font-size: 12px;
      padding: 2px 8px;
      background: #334155;
      border-radius: 8px;
      color: #cbd5e1;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-top: auto;
      color: var(--muted);
    }
    .patched {
      background: var(--danger);
      color: #fff;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 6px;
      margin-left: 8px;
    }

    /* modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal.active { display: flex; }
    .modal-content {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      max-width: 700px;
      width: 92%;
      padding: 20px;
      position: relative;
      max-height: 85vh;
      overflow-y: auto;
    }
    .modal h2 {
      margin: 0 0 6px;
    }
    .modal .game {
      margin-bottom: 14px;
    }
    .close {
      position: absolute;
      top: 12px;
      right: 14px;
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      color: var(--muted);
    }
    pre {
      background: #0f172a;
      border: 1px solid var(--border);
      padding: 14px;
      border-radius: 8px;
      font-size: 13px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-top: 18px;
    }
    .copy-btn {
      background: var(--accent);
      border: none;
      color: #fff;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://i.imgur.com/7J4Qq5U.png" alt="logo"/>
    <input id="search" placeholder="Search for Roblox scripts..."/>
  </header>

  <h1>RoScript Browser</h1>
  <p class="sub">Discover and download the best Roblox scripts from ScriptBlox. Find working scripts with a clean, modern interface.</p>

  <div class="grid" id="grid"></div>

  <!-- modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="close" onclick="closeModal()">&times;</button>
      <h2 id="m-title"></h2>
      <div class="game" id="m-game"></div>
      <div class="desc" id="m-desc"></div>
      <pre id="m-code"></pre>
      <button class="copy-btn" onclick="copyCode()">Copy Script</button>
    </div>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const modal = document.getElementById("modal");
    let ALL = [];
    let currentCode = "";

    async function fetchScripts(){
      try {
        const res = await fetch("https://scriptblox.com/api/script/fetch?page=1&limit=30&mode=recent");
        const data = await res.json();
        ALL = data?.result?.scripts || [];
        render(ALL);
      } catch (err) {
        console.error(err);
        grid.innerHTML = "<p style='color:red'>Failed to load scripts.</p>";
      }
    }

    function render(list){
      grid.innerHTML = "";
      list.forEach(s=>{
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="title">${s.title} ${s.isPatched ? "<span class='patched'>Patched</span>" : ""}</div>
          <div class="game">${s.game || "Unknown"}</div>
          <div class="desc">${s.description?.slice(0,100) || ""}...</div>
          <div class="tags">${(s.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
          <div class="stats">
            <span>üëÅ ${s.views||0}</span>
            <span>‚ù§ ${s.likes||0}</span>
            <span>üìÖ ${s.updatedAt ? new Date(s.updatedAt).toLocaleDateString() : ""}</span>
          </div>
        `;
        card.onclick = ()=>openModal(s);
        grid.appendChild(card);
      });
    }

    async function getScriptCode(s){
      if (s.script) return s.script;
      if (s.slug){
        try {
          const r = await fetch(`https://scriptblox.com/api/script/details?slug=${encodeURIComponent(s.slug)}`);
          const d = await r.json();
          return d?.result?.script || d?.result?.scriptText || "";
        } catch(e){ console.error(e); }
      }
      if (s._id){
        try {
          const r = await fetch(`https://scriptblox.com/api/script/details/${s._id}`);
          const d = await r.json();
          return d?.result?.script || "";
        } catch(e){ console.error(e); }
      }
      return "";
    }

    async function openModal(s){
      document.getElementById("m-title").textContent = s.title;
      document.getElementById("m-game").textContent = s.game || "Unknown";
      document.getElementById("m-desc").textContent = s.description || "";
      document.getElementById("m-code").textContent = "Loading script...";
      modal.classList.add("active");

      const code = await getScriptCode(s);
      currentCode = code;
      document.getElementById("m-code").textContent = code || "No code available.";
    }

    function closeModal(){ modal.classList.remove("active"); }
    function copyCode(){
      navigator.clipboard.writeText(currentCode);
      alert("Copied to clipboard!");
    }

    // search filter
    document.getElementById("search").addEventListener("input",e=>{
      const q = e.target.value.toLowerCase();
      render(ALL.filter(s=>s.title.toLowerCase().includes(q) || (s.game||"").toLowerCase().includes(q)));
    });

    fetchScripts();
  </script>
</body>
</html>
